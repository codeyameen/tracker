<!DOCTYPE html>
<html lang="en">
<head>
  <title>Weekly Stress Report</title>
  <link rel="stylesheet" href="style.css">

  <style>
    .bar {
      width: 100%;
      background: #ddd;
      border-radius: 20px;
      overflow: hidden;
      height: 25px;
      margin-bottom: 15px;
    }

    .bar-fill {
      height: 100%;
      width: 0%;
      color: #fff;
      text-align: center;
      line-height: 25px;
      font-weight: bold;
      transition: width 0.8s ease-in-out;
    }
  </style>
</head>

<body class="student-body">

<div class="main-container">
  <div class="stress-card">
    <h3>ðŸ“ˆ Weekly Stress Report</h3>

    <p>This Week Average Stress</p>
    <div class="bar">
      <div class="bar-fill" id="avgStressBar">0%</div>
    </div>

    <a href="graph.html" class="graph-link">â¬… Back to Stress Page</a>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDqYGleRg4UtrF2r0aFNoeQpbfveOpHWOs",
  authDomain: "academic-query-system.firebaseapp.com",
  projectId: "academic-query-system",
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

function loadWeeklyAverage() {
  const now = new Date();
  const weekAgo = new Date();
  weekAgo.setDate(now.getDate() - 7);

  db.collection("stressReports")
    .where("timestamp", ">=", weekAgo)
    .get()
    .then(snapshot => {

      let total = 0;
      let count = 0;

      snapshot.forEach(doc => {
        const data = doc.data();
        total += Number(data.stressLevel);
        count++;
      });

      let avg = 0;
      if (count > 0) {
        avg = Math.round(total / count);
      }

      const bar = document.getElementById("avgStressBar");
      bar.style.width = avg + "%";
      bar.innerText = avg + "%";

      // Color logic
      if (avg > 85) {
        bar.style.backgroundColor = "green";
      } else if (avg <= 75 && avg > 60) {
        bar.style.backgroundColor = "blue";
      } else if (avg <= 60 && avg > 50) {
        bar.style.backgroundColor = "orange";
      } else {
        bar.style.backgroundColor = "red";
      }

    })
    .catch(error => console.error("Error loading data:", error));
}

loadWeeklyAverage();
</script>

</body>
</html>
